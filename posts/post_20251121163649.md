# NetCDF (.nc) 文件简介
### 什么是NetCDF

NetCDF 是由美国国家水气数据中心（Unidata）开发的一种用于创建、访问和共享科学数据的开源文件格式。它被广泛应用于存储多维数组数据，尤其在科学研究中，如气候研究、海洋科学、遥感等领域。
### 文件结构

一个典型的 NetCDF 文件包含以下几个部分：

- **维度（Dimensions）**：定义数据的维度，如时间、经度、纬度等。例如：`time`, `latitude`, `longitude`。
- **变量（Variables）**：存储数据的实际内容，变量可以是标量或多维数组。例如，温度（temperature）、盐度（salinity）等。
- **属性（Attributes）**：为变量和维度提供额外的信息。例如，单位（units）、数据来源（source）、描述（description）等。

假设有一个海洋环境数据文件 `ocean_data.nc`，该文件可能包含以下信息：
- **维度**：
  - `time`：时间维度，可能有多个时间点
  - `lat`：纬度维度，定义了采样地点的纬度，可能从 -90 到 90
  - `lon`：经度维度，定义了采样地点的经度，可能从 -180 到 180
- **变量**：
  - `temperature`：温度数据，单位可能为摄氏度
  - `salinity`：盐度数据，单位为 psu（实用盐度单位）
# C#读取NetCDF文件
### 准备环境
C# 读取 NetCDF 文件需要使用库 ```ScientificDataSet.dll```和``netCDF``软件 
1. 下载 ``ScientificDataSet.dll``: [Scientific Data Set](https://www.microsoft.com/en-us/research/project/scientific-dataset/)  
或者NuGet 安装 SDSLite ：  
 ```bash  
  dotnet add package SDSLite --version 3.0.1
```
 2. 安装``netCDF 4.9. 2``软件
下载地址：[netCDF4.9.2-NC4-64.exe](https://downloads.unidata.ucar.edu/netcdf-c/4.9.2/netCDF4.9.2-NC4-64.exe)

*不同版本的电脑对netCDF版本需求不同，这里给出更多版本的下载地址：https://downloads.unidata.ucar.edu/netcdf/* 
### 使用方式
- **Unity**：将`ScientificDataSet.dll`放入Plugin文件夹即可
- **.Net**：NuGet安装`SDSLite`

以下是示例代码：
```csharp
using Microsoft.Research.Science.Data;
using Microsoft.Research.Science.Data.Imperative;

// 从unidata网站下载netCDF文件
var client = new System.Net.Http.HttpClient();
var response = await client.GetAsync("https://www.unidata.ucar.edu/software/netcdf/examples/sresa1b_ncar_ccsm3-example.nc");
using (var stream = System.IO.File.OpenWrite("sresa1b_ncar_ccsm3-example.nc")){
    await response.Content.CopyToAsync(stream);
}

// 打开文件并打印一些信息
using (DataSet ds = DataSet.Open("msds:nc?file=sresa1b_ncar_ccsm3-example.nc&openMode=readOnly")){
    Console.WriteLine(ds);
    Console.WriteLine(ds.Metadata["comment"]);
    //提取数据，记得对应好nc数据集中的格式
    var lat = ds.GetData<float[]>("lat");
    var ua = ds.GetData<float[,,,]>("ua");
    var plev = ds.GetData<double[]>("plev"); 
    Console.WriteLine($"latitude: len={lat.Length}, min={lat.Min()}, max={lat.Max()}");
}
```
输出：
```
msds:nc?openMode=readOnly&file=c:\Users\***\sresa1b_ncar_ccsm3-example.nc
[1]
DSID: ca6c1f06-f743-4190-9b94-20cf0cbc18f7
[12] ua of type Single (time:1) (plev:17) (lat:128) (lon:256)
[11] time_bnds of type Double (time:1) (bnds:2)
[10] time of type Double (time:1)
[9] tas of type Single (time:1) (lat:128) (lon:256)
[8] pr of type Single (time:1) (lat:128) (lon:256)
[7] plev of type Double (plev:17)
[6] msk_rgn of type Int32 (lat:128) (lon:256)
[5] lon_bnds of type Double (lon:256) (bnds:2)
[4] lon of type Single (lon:256)
[3] lat_bnds of type Double (lat:128) (bnds:2)
[2] lat of type Single (lat:128)
[1] area of type Single (lat:128) (lon:256)

This simulation was initiated from year 2000 of 
 CCSM3 model run b30.030a and executed on 
 hardware cheetah.ccs.ornl.gov. The input external forcings are
ozone forcing    : A1B.ozone.128x64_L18_1991-2100_c040528.nc
aerosol optics   : AerosolOptics_c040105.nc
aerosol MMR      : AerosolMass_V_128x256_clim_c031022.nc
carbon scaling   : carbonscaling_A1B_1990-2100_c040609.nc
solar forcing    : Fixed at 1366.5 W m-2
GHGs             : ghg_ipcc_A1B_1870-2100_c040521.nc
GHG loss rates   : noaamisc.r8.nc
volcanic forcing : none
DMS emissions    : DMS_emissions_128x256_clim_c040122.nc
oxidants         : oxid_128x256_L26_clim_c040112.nc
SOx emissions    : SOx_emissions_A1B_128x256_L2_1990-2100_c040608.nc
 Physical constants used for derived data:
 Lv (latent heat of evaporation): 2.501e6 J kg-1
 Lf (latent heat of fusion     ): 3.337e5 J kg-1
 r[h2o] (density of water      ): 1000 kg m-3
 g2kg   (grams to kilograms    ): 1000 g kg-1
 
 Integrations were performed by NCAR and CRIEPI with support
 and facilities provided by NSF, DOE, MEXT and ESC/JAMSTEC.
 latitude: len=128, min=-88.927734, max=88.927734
 ```
# 其他：
相关资源下载：[ScientificDataSet.dll和NetCDF.exe]
