# Unity ç¼–è¾‘å™¨æ‰©å±•ï¼šå°è¯´é˜…è¯»å™¨
# å‰è¨€
æƒ³çœ‹å°è¯´åˆä¸æƒ³å¤šå¼€ä¸€ä¸ªç¨‹åºåœ¨æ¡Œé¢ä¸Šï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„è„šæœ¬é˜…è¯»å™¨èåˆè¿›Unityçš„æ£€è§†çª—å£
å…¶å®å°±æ˜¯ä¸Šç­æ‘¸é±¼æ—¶ç”¨çš„ï¼ğŸ˜

***è¦ç‚¹ï¼š***
 - ä½¿ç”¨çš„Unityè‡ªåŠ¨çš„PlayerPrefsè¿›è¡Œè¿›åº¦çš„ä¿å­˜ 
 - è¯†åˆ«ç›®å½•ç”¨çš„ç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼ 
 - è¯†åˆ«é€Ÿåº¦è¿˜è¡Œï¼Œ2000ç« çš„æ–‡æœ¬ç”¨ä¸äº†1ç§’å°±èƒ½è¯†åˆ«å®Œæ¯•
 - æ”¯æŒæŒ‰é”®ç»‘å®š
# æ•ˆæœæ¼”ç¤º

# ä½¿ç”¨æ­¥éª¤
## 1.å¼•å…¥ä»£ç 

```csharp
using System.Collections;
using System.Collections.Generic;
using System.Text.RegularExpressions;
using UnityEditor;
using UnityEngine;

public class NovelFish : MonoBehaviour
{
    private string[] _novelChapters;
    private string[] _novelWords;

    //å°è¯´æ˜¾ç¤ºå†…å®¹
    [Multiline(10)]
    public string novel = "";
    //TXTæ–‡æœ¬æ–‡ä»¶
    public TextAsset novelFile;
    public KeyCode ä¸Šä¸€é¡µ = KeyCode.Mouse0;
    public KeyCode ä¸‹ä¸€é¡µ = KeyCode.Mouse1;
    public KeyCode éšè— = KeyCode.Mouse2;
    public KeyCode è‡ªåŠ¨æ’­æ”¾ = KeyCode.A;
    public KeyCode ä¸Šä¸€ç«  = KeyCode.PageUp;
    public KeyCode ä¸‹ä¸€ç«  = KeyCode.PageDown;

    public bool _isPlaying;
    public int ChapterTarget;
    private int ChapterIndex
    {
        get => PlayerPrefs.GetInt("Chapter_" + novelFile.name, 0);
        set => PlayerPrefs.SetInt("Chapter_" + novelFile.name, value);
    }

    private int NowChapterIndex
    {
        get => PlayerPrefs.GetInt("Now_" + novelFile.name, 0);
        set => PlayerPrefs.SetInt("Now_" + novelFile.name, value);
    }


    private void Start()
    {
        LoadNovel();
    }

    //ç« èŠ‚è·³è½¬
    [ContextMenu("ç« èŠ‚è·³è½¬")]
    private void JumpPage()
    {
        if (ChapterTarget < 0 || ChapterTarget >= _novelChapters.Length)
            return;
        ChapterIndex = ChapterTarget;
        NowChapterIndex = 0;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterTarget]);
        novel = _novelWords[NowChapterIndex];
    }

    //é‡ç½®æ–‡ç« 
    [ContextMenu("é‡ç½®æ–‡ç« ")]
    private void ResetText()
    {
        NowChapterIndex = 0;
        ChapterIndex = 0;
        LoadNovel();
        print("æ€»ç« æ•°ï¼š" + _novelChapters.Length);
    }

    //æ–‡ç« ï¼ˆæŒ‰ç« èŠ‚ï¼‰åŠ è½½
    private void LoadNovel()
    {
        //ç¬¬1ç« 
        var pattern = @"(?m)^[ç¬¬][0-9]{1,4}[ç« ]";
        //000 nnn
        // var pattern = @"(?m)^\d{3,4}[\s]";
        //ç¬¬ä¸€ç«  ï¼ˆä¸­æ–‡æ•°å­—ï¼‰
	    // var pattern = @"(?m)^[ç¬¬][\u4e00-\u9fa5]{1,5}[ç« ]";


        var novelChapters = Regex.Split(novelFile.text, pattern);
        for (var i = 0; i < novelChapters.Length; i++)
        {
            novelChapters[i] = "ç¬¬" + i + "ç« " + novelChapters[i];
        }

        _novelChapters = novelChapters;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        // novel = _novelWords[NowChapterIndex];
    }

    //æŒ‰é”®ç»‘å®š
    public void Update()
    {
        if (Input.GetKeyDown(ä¸‹ä¸€é¡µ))
            PageDown();
        if (Input.GetKeyDown(ä¸Šä¸€é¡µ))
            PageUp();
        if (Input.GetKeyDown(éšè—))
            Hide();
        if (Input.GetKeyDown(è‡ªåŠ¨æ’­æ”¾))
            AutoPlay();
        if (Input.GetKeyDown(ä¸Šä¸€ç« ))
            UpChapter();
        if (Input.GetKeyDown(ä¸‹ä¸€ç« ))
            DownChapter(); 
    }

    //ä¸Šä¸€ç« 
    private void PageUp()
    {
        NowChapterIndex--;
        if (NowChapterIndex == -1)
        {
            ChapterIndex--;
            _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
            NowChapterIndex = _novelWords.Length - 1;
        }

        novel = _novelWords[NowChapterIndex];
    }

    //ä¸‹ä¸€ç« 
    private void PageDown()
    {
        NowChapterIndex++;
        if (NowChapterIndex == _novelWords.Length)
        {
            ChapterIndex++;
            NowChapterIndex = 0;
            _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        }

        novel = _novelWords[NowChapterIndex];
    }

    //ä¸‹ä¸€é¡µ
    private void DownChapter()
    {
        ChapterIndex++;
        NowChapterIndex = 0;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        novel = _novelWords[NowChapterIndex];
    }

    //ä¸Šä¸€é¡µ
    private void UpChapter()
    {
        ChapterIndex--;
        NowChapterIndex = 0;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        novel = _novelWords[NowChapterIndex];
    }

    //è‡ªåŠ¨æ’­æ”¾
    private void AutoPlay()
    {
        _isPlaying = !_isPlaying;
        if (_isPlaying)
            StartCoroutine(nameof(AutoPlayIe));
        else
            StopCoroutine(nameof(AutoPlayIe));
    }

    private IEnumerator AutoPlayIe()
    {
        PageDown();
        // è‡ªåŠ¨æ’­æ”¾å»¶è¿Ÿ
        yield return new WaitForSeconds(5f);
        StartCoroutine(nameof(AutoPlayIe));
    }

    //å¿«é€Ÿéšè—ï¼ˆæ˜¾ç¤ºï¼‰
    private void Hide()
    {
        var haveWord = novel != "";
        novel = haveWord ? "" : _novelWords[NowChapterIndex];
    }

    //æ–‡å­—æœ€å¤šæ˜¾ç¤ºæ•°é‡
    private const int MaxWordLength = 200;

    /// <summary>
    /// åŠ è½½æ–‡ç« ç‰‡æ®µ
    /// </summary>
    private static string[] LoadOriginalWord(string word)
    {
        var novelFileList = new List<string>();
        var originalWord = word.Split('\n');
        for (var i = 0; i < originalWord.Length; i++)
        {
            //å¤„ç†æ‰ç©ºå­—ç¬¦ä¸²
            originalWord[i] = Regex.Replace(originalWord[i], @"\s", "");
            if (originalWord[i].Length > 1 && originalWord[i].Length <= 200)
            {
                novelFileList.Add(originalWord[i]);
            }
            else if (originalWord[i].Length > 200)
            {
                var ccl = originalWord[i].Length / MaxWordLength;
                for (var j = 0; j <= ccl; j++)
                {
                    if (originalWord[i].Length != j * MaxWordLength)
                        novelFileList.Add(originalWord[i].Substring(j * MaxWordLength,
                            j == ccl ? (originalWord[i].Length - j * MaxWordLength) - 1 : MaxWordLength));
                }
            }
        }

        return novelFileList.ToArray();
    }
}

```
odinæ’ä»¶ç‰ˆ
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/1af3cc8a4eb94dda4e0d528d4a66c1e6.png)

```csharp
using Sirenix.OdinInspector;
using System.Collections;
using System.Collections.Generic;
using System.Text.RegularExpressions;
using UnityEngine;

public class NovelFish : MonoBehaviour
{
    public enum TitleType
    {
        T00Z,  // 00 Z
        D00Z,  // DI 00 Z
        DCNZ,  // DI CNNUME Z
    }
    private string[] _novelChapters;
    private string[] _novelWords;
    private const int MAX_WORD_LENGTH = 200;
    [Multiline(9), ReadOnly]
    public string novel = "";

    [FoldoutGroup("SET")] public TextAsset novelFile;
    [FoldoutGroup("SET")] public TitleType titleType;
    [FoldoutGroup("SET")] public KeyCode Up = KeyCode.Mouse0;
    [FoldoutGroup("SET")] public KeyCode Down = KeyCode.Mouse1;
    [FoldoutGroup("SET")] public KeyCode HideKey = KeyCode.Mouse2;
    [FoldoutGroup("SET")] public KeyCode Auto = KeyCode.A;
    [FoldoutGroup("SET")] public KeyCode PageUpKey = KeyCode.PageUp;
    [FoldoutGroup("SET")] public KeyCode PageDownKey = KeyCode.PageDown;
    [FoldoutGroup("SET")] public KeyCode Stop = KeyCode.P;
    [FoldoutGroup("SET"), Range(1f, 20f)] public float AutoSpeed = 5f;

    private bool _isPlaying;
    private bool _isPaused = true;

    private int ChapterIndex
    {
        get => PlayerPrefs.GetInt("Chapter_" + novelFile.name, 0);
        set => PlayerPrefs.SetInt("Chapter_" + novelFile.name, value);
    }
    private int NowChapterIndex
    {
        get => PlayerPrefs.GetInt("Now_" + novelFile.name, 0);
        set => PlayerPrefs.SetInt("Now_" + novelFile.name, value);
    }

    private void Start()
    {
        if (novelFile == null)
        {
            _isPaused = true;
            return;
        }
        LoadNovel();
    }

    [Button(Expanded = true), FoldoutGroup("SET")]
    private void JumpPage(int num)
    {
        if (num < 0 || num >= _novelChapters.Length)
            return;
        ChapterIndex = num;
        NowChapterIndex = 0;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        novel = _novelWords[NowChapterIndex];
    }

    [Button, FoldoutGroup("SET")]
    private void Clear()
    {
        novel = "";
    }

    [Button, FoldoutGroup("SET")]
    private void ResetText()
    {
        NowChapterIndex = 0;
        ChapterIndex = 0;
        LoadNovel();
        print("Totalï¼š" + _novelChapters.Length);
    }

    private void LoadNovel()
    {
        string pattern = string.Empty;
        switch (titleType)
        {
            case TitleType.T00Z:
                pattern = @"(?m)^\d{3,4}[\s]";
                break;
            case TitleType.D00Z:
                pattern = @"(?m)^[ç¬¬][0-9]{1,4}[ç« ]";
                break;
            case TitleType.DCNZ:
                pattern = @"(?m)^[ç¬¬][\u4e00-\u9fa5]{1,5}[ç« ]";
                break;
        }

        var novelChapters = Regex.Split(novelFile.text, pattern);
        for (var i = 0; i < novelChapters.Length; i++)
        {
            novelChapters[i] = "ç¬¬" + i + "ç« " + novelChapters[i];
        }

        _novelChapters = novelChapters;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
    }

    //æŒ‰é”®ç»‘å®š
    public void Update()
    {
        if (Input.GetKeyDown(Stop))
            _isPaused = !_isPaused;
        if (_isPaused) return;

        if (Input.GetKeyDown(Down))
            PageDown();
        if (Input.GetKeyDown(Up))
            PageUp();
        if (Input.GetKeyDown(HideKey))
            Hide();
        if (Input.GetKeyDown(Auto))
            AutoPlay();
        if (Input.GetKeyDown(PageUpKey))
            UpChapter();
        if (Input.GetKeyDown(PageDownKey))
            DownChapter();
    }

    //ä¸Šä¸€ç« 
    private void PageUp()
    {
        NowChapterIndex--;
        if (NowChapterIndex == -1)
        {
            ChapterIndex--;
            _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
            NowChapterIndex = _novelWords.Length - 1;
        }
        novel = _novelWords[NowChapterIndex];
    }


    public void PageDown(int page)
    {
        NowChapterIndex += page;
        if (NowChapterIndex >= _novelWords.Length)
        {
            ChapterIndex++;
            NowChapterIndex = 0;
            _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        }

        novel = _novelWords[NowChapterIndex];
    }

    private void PageDown()
    {
        NowChapterIndex++;
        if (NowChapterIndex == _novelWords.Length)
        {
            ChapterIndex++;
            NowChapterIndex = 0;
            _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        }

        novel = _novelWords[NowChapterIndex];
    }


    private void DownChapter()
    {
        ChapterIndex++;
        NowChapterIndex = 0;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        novel = _novelWords[NowChapterIndex];
    }


    private void UpChapter()
    {
        ChapterIndex--;
        NowChapterIndex = 0;
        _novelWords = LoadOriginalWord(_novelChapters[ChapterIndex]);
        novel = _novelWords[NowChapterIndex];
    }

    private void AutoPlay()
    {
        _isPlaying = !_isPlaying;
        if (_isPlaying)
            StartCoroutine(nameof(AutoPlayIe));
        else
            StopCoroutine(nameof(AutoPlayIe));
    }

    private IEnumerator AutoPlayIe()
    {
        PageDown();
        yield return new WaitForSeconds(AutoSpeed);
        if (_isPaused)
        {
            _isPlaying = false;
        }
        else
        {
            StartCoroutine(nameof(AutoPlayIe));
        }
    }

    //å¿«é€Ÿéšè—ï¼ˆæ˜¾ç¤ºï¼‰
    private void Hide()
    {
        var haveWord = novel != "";
        novel = haveWord ? "" : _novelWords[NowChapterIndex];
    }

    /// <summary>
    /// åŠ è½½æ–‡ç« ç‰‡æ®µ
    /// </summary>
    private static string[] LoadOriginalWord(string word)
    {
        var novelFileList = new List<string>();
        var originalWord = word.Split('\n');
        for (var i = 0; i < originalWord.Length; i++)
        {
            //å¤„ç†æ‰ç©ºå­—ç¬¦ä¸²
            originalWord[i] = Regex.Replace(originalWord[i], @"\s", "");
            if (originalWord[i].Length > 1 && originalWord[i].Length <= 200)
            {
                novelFileList.Add(originalWord[i]);
            }
            else if (originalWord[i].Length > 200)
            {
                var ccl = originalWord[i].Length / MAX_WORD_LENGTH;
                for (var j = 0; j <= ccl; j++)
                {
                    if (originalWord[i].Length != j * MAX_WORD_LENGTH)
                        novelFileList.Add(originalWord[i].Substring(j * MAX_WORD_LENGTH,
                            j == ccl ? (originalWord[i].Length - j * MAX_WORD_LENGTH) - 1 : MAX_WORD_LENGTH));
                }
            }
        }

        return novelFileList.ToArray();
    }
}


```

## 2.å¯¼å…¥çš„å°è¯´æ–‡æœ¬ TXT
`è®°å¾—è¦å°†å¯¼å…¥çš„txtæ ¼å¼è®¾ç½®ä¸ºUTF-8ä¸ç„¶è¯†åˆ«ä¸å‡ºæ¥`
å¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€è®©åå¦å­˜ä¸ºæ—¶è®¾ç½®æ ¼å¼å°±å¥½äº†
## 3.åœ¨ä»£ç å—é‡Œé€‰æ‹©ä½ ä¸‹è½½æ–‡ä»¶çš„ç›®å½•æ ¼å¼
åœ¨70è¡Œä»£ç å·¦å³`æ³¨é‡Šæ‰ä¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼éƒ¨åˆ†`


## 4.æ‹–å…¥æ–‡æœ¬æ–‡ä»¶å†é€‰æ‹©é‡ç½®æ–‡ç« å³å¯

# æ€»ç»“
ç›®å‰ç¼ºé™·è¿˜æ˜¯æœ‰çš„ï¼Œä¸èƒ½è‡ªåŠ¨è¯†åˆ«å°è¯´ç›®å½•æ ¼å¼ï¼Œå¿…é¡»åœ¨æ¸¸æˆè¿è¡Œæ¨¡å¼ä¸‹ä½¿ç”¨ï¼ˆç”¨çš„Inputæ£€æµ‹ï¼‰ã€‚
æœ‰ç©ºè¿˜æ˜¯å¯ä»¥æ”¹æ”¹çš„ã€‚
