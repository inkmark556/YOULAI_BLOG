<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article View | Youlai Note</title>
    <link rel="stylesheet" href="/public/css/base.css">
    <link rel="stylesheet" href="/public/css/background.css">
    <link rel="stylesheet" href="/public/css/layout.css">
    <link rel="stylesheet" href="/public/css/posts.css">
    <link rel="stylesheet" href="/public/css/model.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Markdown & Syntax Highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
</head>

<body>
    <div class="bg-layer">
        <div class="bg-stripes"></div>
        <div class="bg-dots"></div>
        <div class="shape shape-star" style="top: 10%; left: 10%; animation-duration: 8s;">★</div>
        <div class="shape shape-star"
            style="top: 50%; right: 15%; animation-duration: 12s; font-size: 1.5rem; color:var(--p5-yellow);">★</div>
        <div class="shape shape-shard" style="left: 20%; width: 60px; height: 60px; animation-delay: 0s;"></div>
        <div class="shape shape-shard" style="left: 70%; width: 40px; height: 40px; animation-delay: 5s;"></div>
        <div class="shape shape-shard"
            style="left: 45%; width: 80px; height: 80px; animation-delay: 2s; background: var(--p5-black);"></div>
        <div class="shape shape-jagged" style="top: 80%; left: 5%; animation-duration: 3s;"></div>
        <div class="shape shape-jagged" style="top: 20%; right: 5%; animation-duration: 4s; transform: scale(0.5);">
        </div>
    </div>

    <nav class="top-nav">
        <a href="/" class="brand-logo">Youlai Note (Admin)</a>
        <div class="menu-list">
            <a href="/" class="menu-btn">◄ BACK</a>
            <a href="#" id="edit-btn" class="menu-btn" style="background:var(--p5-yellow); color:black;">EDIT</a>
        </div>
    </nav>

    <div class="container">
        <main class="content-area"
            style="background: white; padding: 40px; border: 3px solid black; box-shadow: 10px 10px 0 rgba(0,0,0,0.2);">
            <h1 id="post-title" style="font-family: 'Bangers'; font-size: 2.5rem; margin-bottom: 10px;">Loading...</h1>
            <div class="post-meta" style="color:#666; margin-bottom: 20px;">
                <span id="post-date"></span> · <span id="post-tags"
                    style="background:var(--p5-red); color:white; padding:2px 5px; font-size:0.8rem;"></span>
            </div>

            <img id="post-cover"
                style="width:100%; max-height:400px; object-fit:cover; border:2px solid black; margin-bottom:30px; display:none;">

            <div id="markdown-content" class="markdown-body"></div>
        </main>
    </div>

    <footer class="footer-bar" style="margin-top: 50px;">
        <div class="footer-info">
            <div>© 2025 YOU LAI NOTE</div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Get ID from URL path: /posts/post_id
            const pathParts = window.location.pathname.split('/');
            const postId = pathParts[pathParts.length - 1];

            if (!postId) {
                document.getElementById('post-title').innerText = "ERROR: No Post ID";
                return;
            }

            // Setup Edit Button
            document.getElementById('edit-btn').href = `/editor.html?id=${postId}`;

            try {
                // 1. Fetch Metadata
                const resMeta = await fetch('/posts.json');
                const posts = await resMeta.json();
                const post = posts.find(p => p.id === postId);

                if (post) {
                    document.getElementById('post-title').innerText = post.title;
                    document.getElementById('post-date').innerText = post.date;
                    document.getElementById('post-tags').innerText = Array.isArray(post.tags) ? post.tags.join(' / ') : post.tags;

                    if (post.cover) {
                        const coverImg = document.getElementById('post-cover');
                        coverImg.src = post.cover;
                        coverImg.style.display = 'block';
                    }
                }

                // 2. Fetch Content
                const resContent = await fetch(`/posts/${postId}.md`);
                if (!resContent.ok) throw new Error("Content not found");
                const markdown = await resContent.text();

                // Render Markdown
                document.getElementById('markdown-content').innerHTML = marked.parse(markdown);

                // Highlight Code
                Prism.highlightAll();

                // 3. Add Copy Buttons to Code Blocks
                addCopyButtons();

            } catch (err) {
                console.error(err);
                document.getElementById('markdown-content').innerHTML = `<h2 style="color:red">FAILED TO LOAD CONTENT</h2><p>${err.message}</p>`;
            }
        });

        function addCopyButtons() {
            const codeBlocks = document.querySelectorAll('pre');
            codeBlocks.forEach(pre => {
                // Create wrapper
                const wrapper = document.createElement('div');
                wrapper.className = 'code-wrapper';

                // Create button
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerText = 'COPY';

                btn.addEventListener('click', () => {
                    const code = pre.querySelector('code').innerText;
                    navigator.clipboard.writeText(code).then(() => {
                        btn.innerText = 'COPIED!';
                        setTimeout(() => btn.innerText = 'COPY', 2000);
                    });
                });

                // Wrap pre
                pre.parentNode.insertBefore(wrapper, pre);
                wrapper.appendChild(pre);
                wrapper.appendChild(btn);
            });
        }
    </script>
</body>

</html>